<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Memory Allocation Visualizer — Partition Mode</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- LEFT: Memory Setup -->
        <div class="left">
            <div class="card">
                <div class="header"><div class="h1">Memory Setup</div><div class="hsub">Configure simulation</div></div>

                <label>Memory Size (KB)</label>
                <input id="memSize" type="number" value="1000" min="64">

                <label>Mode</label>
                <div class="row" style="gap:8px;margin-top:6px">
                    <button id="tabSingle" class="small" style="background:linear-gradient(90deg,var(--accent),#9b5cff)">Single</button>
                    <button id="tabComparison" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Compare</button>
                    <button id="tabPartition" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Partition</button>
                </div>

                <label style="margin-top:10px">Algorithm (single mode only)</label>
                <div class="row" style="gap:12px;margin-top:6px">
                    <label><input type="radio" name="algo" value="first" checked> First Fit</label>
                    <label><input type="radio" name="algo" value="best"> Best Fit</label>
                    <label><input type="radio" name="algo" value="worst"> Worst Fit</label>
                </div>

                <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">

                <div style="margin-bottom:6px" class="tiny">Add Process</div>
                <label>Process ID</label><input id="procId" type="text" placeholder="P1">
                <label>Size (KB)</label><input id="procSize" type="number" placeholder="200" min="1">
                <label>Arrival Time</label><input id="procArrival" type="number" value="0" min="0">

                <div style="display:flex;gap:8px;margin-top:8px">
                    <button id="addProcBtn" class="small">➕ Add</button>
                    <button id="clearProcs" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Clear</button>
                </div>

                <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">

                <div style="margin-top:6px">
                    <div class="tiny" style="margin-bottom:6px">Processes</div>
                    <table id="procTable"><thead><tr><th>ID</th><th>Size</th><th>Arr</th><th></th></tr></thead><tbody></tbody></table>
                </div>

                <div style="display:flex;gap:8px;margin-top:12px">
                    <button id="runBtn" class="small">▶ Generate Trace</button>
                    <button id="exportPNG" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Export PNG</button>
                </div>
            </div>
        </div>

        <!-- CENTER: Canvas area (single, comparison vertical, or partition) -->
        <div class="center">
            <!-- SINGLE MODE -->
            <div class="card canvas-wrap" id="singleModePanel">
                <div class="header">
                    <div>
                        <div class="h1">Memory Visualization (Single)</div>
                        <div class="hsub">Single-mode canvas</div>
                    </div>
                    <div class="hsub">Algorithm: <span id="algoLabel">First Fit</span></div>
                </div>

                <canvas id="memCanvas" width="980" height="360"></canvas>

                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div class="tiny">Step: <span id="curStep">0</span>/<span id="maxStep">0</span></div>
                    <div class="tiny">Utilization: <span id="util">0%</span></div>
                </div>

                <input id="timeline" type="range" min="0" max="0" value="0" style="width:100%;margin-top:8px">
            </div>

            <!-- COMPARISON MODE: vertical stacked -->
            <div class="card canvas-wrap" id="comparisonPanel" style="display:none">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <div>
                        <div class="h1">Comparison Mode</div>
                        <div class="hsub">Fixed partitions with process allocation — First Fit | Best Fit | Worst Fit</div>
                    </div>
                    <div class="hsub">Partition Allocation Comparison</div>
                </div>

                <div class="comp-vertical">
                    <!-- FIRST FIT block -->
                    <div class="comp-block" id="blockFF">
                        <div style="font-weight:700">First Fit</div>
                        <canvas id="canvasFF" class="comp-canvas" width="780" height="220"></canvas>
                        <div class="comp-stats-row">
                            <div class="stat-pill" id="statFF">Util: —%</div>
                            <div class="stat-pill" id="fragCountFF">Free partitions: —</div>
                            <div class="stat-pill" id="largestFreeFF">Allocated: —</div>
                            <div class="stat-pill" id="extFragFF">Waste: — KB</div>
                        </div>
                        <div class="alg-log" id="logFF">No logs yet.</div>
                    </div>

                    <!-- BEST FIT block -->
                    <div class="comp-block" id="blockBF">
                        <div style="font-weight:700">Best Fit</div>
                        <canvas id="canvasBF" class="comp-canvas" width="780" height="220"></canvas>
                        <div class="comp-stats-row">
                            <div class="stat-pill" id="statBF">Util: —%</div>
                            <div class="stat-pill" id="fragCountBF">Free partitions: —</div>
                            <div class="stat-pill" id="largestFreeBF">Allocated: —</div>
                            <div class="stat-pill" id="extFragBF">Waste: — KB</div>
                        </div>
                        <div class="alg-log" id="logBF">No logs yet.</div>
                    </div>

                    <!-- WORST FIT block -->
                    <div class="comp-block" id="blockWF">
                        <div style="font-weight:700">Worst Fit</div>
                        <canvas id="canvasWF" class="comp-canvas" width="780" height="220"></canvas>
                        <div class="comp-stats-row">
                            <div class="stat-pill" id="statWF">Util: —%</div>
                            <div class="stat-pill" id="fragCountWF">Free partitions: —</div>
                            <div class="stat-pill" id="largestFreeWF">Allocated: —</div>
                            <div class="stat-pill" id="extFragWF">Waste: — KB</div>
                        </div>
                        <div class="alg-log" id="logWF">No logs yet.</div>
                    </div>
                </div>

                <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
                    <div class="tiny">Step: <span id="curStepC">0</span>/<span id="maxStepC">0</span></div>
                    <div class="tiny">Global Util: <span id="utilC">0%</span></div>
                </div>

                <input id="timelineC" type="range" min="0" max="0" value="0" style="width:100%;margin-top:8px">
            </div>

            <!-- PARTITION MODE -->
            <div class="card canvas-wrap" id="partitionPanel" style="display:none">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <div>
                        <div class="h1">Partition Mode</div>
                        <div class="hsub">Fixed partitions with process allocation</div>
                    </div>
                    <div class="hsub">Algorithm: <span id="partitionAlgoLabel">First Fit</span></div>
                </div>

                <canvas id="partitionCanvas" width="980" height="360"></canvas>

                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div class="tiny">Step: <span id="curStepP">0</span>/<span id="maxStepP">0</span></div>
                    <div class="tiny">Utilization: <span id="utilP">0%</span></div>
                </div>

                <input id="timelineP" type="range" min="0" max="0" value="0" style="width:100%;margin-top:8px">
                
                <!-- Execution logs moved below canvas in partition mode -->
                <div style="margin-top:12px">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div class="h1" style="font-size:14px">Execution Logs</div>
                        <div class="hsub" id="statusLabelP">Idle</div>
                    </div>
                    <div id="partitionLog" style="margin-top:8px;height:120px;overflow:auto;font-family:monospace;color:var(--muted);padding:8px;background:rgba(0,0,0,0.06);border-radius:8px">No logs yet.</div>
                </div>
            </div>

            <div style="display:flex;gap:12px">
                <div class="card" style="flex:1">
                    <div class="tiny">Execution summary</div>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
                        <div class="pill" id="summaryAlloc">Allocations: 0</div>
                        <div class="pill" id="summarySteps">Steps: 0</div>
                    </div>
                </div>

                <div class="card" style="width:260px">
                    <div class="tiny">Export & actions</div>
                    <div style="display:flex;gap:8px;margin-top:8px">
                        <button id="exportTrace" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Export Trace</button>
                        <button id="clearAll" class="small" style="background:crimson">Clear</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Logs (single/compare) or Partition Inputs (partition mode) -->
        <div class="right">
            <!-- Default right panel (logs & stats for single/compare modes) -->
            <div id="defaultRightPanel">
                <div class="card" style="display:flex;flex-direction:column;flex:1">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div class="h1" style="font-size:14px">Execution Logs</div>
                        <div class="hsub" id="statusLabel">Idle</div>
                    </div>
                    <div id="log" style="margin-top:8px;flex:1;overflow:auto;font-family:monospace;color:var(--muted);padding:8px;background:rgba(0,0,0,0.06);border-radius:8px">No logs yet.</div>
                </div>

                <div class="card" style="flex:0">
                    <div class="h1" style="font-size:14px">Statistics</div>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                        <div>Average Waiting Time: <span id="avgWaiting" style="font-weight:600">—</span></div>
                        <div>Average Turnaround: <span id="avgTurn" style="font-weight:600">—</span></div>
                        <div>External Fragmentation: <span id="extFrag" style="font-weight:600">—</span></div>
                        <div>Total Processes: <span id="totalProc" style="font-weight:600">0</span></div>
                    </div>
                </div>
            </div>

            <!-- Partition inputs (shown only in partition mode) -->
            <div id="partitionRightPanel" style="display:none">
                <div class="card">
                    <div class="header"><div class="h1">Partition Setup</div><div class="hsub">Configure fixed partitions</div></div>

                    <label>Partition Algorithm</label>
                    <select id="partitionAlgo">
                        <option value="first">First Fit</option>
                        <option value="best">Best Fit</option>
                        <option value="worst">Worst Fit</option>
                    </select>

                    <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">

                    <div style="margin-bottom:6px" class="tiny">Add Partition</div>
                    <label>Partition ID</label><input id="partId" type="text" placeholder="Part1">
                    <label>Size (KB)</label><input id="partSize" type="number" placeholder="300" min="1">

                    <div style="display:flex;gap:8px;margin-top:8px">
                        <button id="addPartBtn" class="small">➕ Add Partition</button>
                        <button id="clearParts" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Clear</button>
                    </div>

                    <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">

                    <div style="margin-top:6px">
                        <div class="tiny" style="margin-bottom:6px">Partitions</div>
                        <table id="partTable"><thead><tr><th>ID</th><th>Size</th><th></th></tr></thead><tbody></tbody></table>
                    </div>

                    <div style="margin-top:12px">
                        <div class="tiny" style="margin-bottom:6px">Partition Statistics</div>
                        <div style="display:flex;flex-direction:column;gap:6px">
                            <div>Total Partition Size: <span id="totalPartSize" style="font-weight:600">0 KB</span></div>
                            <div>Available Partitions: <span id="partCount" style="font-weight:600">0</span></div>
                            <div>Largest Partition: <span id="largestPart" style="font-weight:600">—</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating bottom bar -->
    <div id="floatingBar" class="floating-bar" aria-hidden="true">
        <button id="runBtnBottom" class="ctrl-square secondary tooltip" data-tip="Generate Trace (same as left)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 3v18l15-9L5 3z" fill="currentColor"/></svg></button>
        <button id="playBtn" class="ctrl-square tooltip" data-tip="Play"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M5 3v18l15-9L5 3z" fill="currentColor"/></svg></button>
        <button id="pauseBtn" class="ctrl-square secondary tooltip" data-tip="Pause"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" fill="currentColor"/></svg></button>
        <button id="prevBtn" class="ctrl-square secondary tooltip" data-tip="Prev"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M11 18V6l-8 6 8 6zm9 0V6h-2v12h2z" fill="currentColor"/></svg></button>
        <button id="nextBtn" class="ctrl-square secondary tooltip" data-tip="Next"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6v12l8-6-8-6zm9 12V6h2v12h-2z" fill="currentColor"/></svg></button>
        <button id="restartBtn" class="ctrl-square tooltip" data-tip="Restart"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 5V1L7 6l5 5V7c3.86 0 7 3.14 7 7 0 1.1-.3 2.13-.82 3.02L19.6 18A9 9 0 0012 5z" fill="currentColor"/></svg></button>
    </div>

    <script src="script.js"></script>
</body>
</html>